'use client'

import { useState, useEffect } from 'react'
import { motion, useScroll, useMotionValueEvent, AnimatePresence } from 'framer-motion'
import Link from 'next/link'

export default function Logo() {
  const [isVisible, setIsVisible] = useState(false)
  const [hasLoadingFinished, setHasLoadingFinished] = useState(false)
  const { scrollY } = useScroll()

  // Verifica se o loading acabou observando mudanças no DOM
  useEffect(() => {
    const checkLoading = () => {
      // Verifica se o loader não está mais presente
      const loader = document.querySelector('[data-loader]')
      if (!loader && !hasLoadingFinished) {
        setHasLoadingFinished(true)
        setIsVisible(true)
      }
    }

    // Verifica inicialmente
    checkLoading()

    // Observa mudanças no DOM
    const observer = new MutationObserver(checkLoading)
    observer.observe(document.body, { childList: true, subtree: true })

    return () => observer.disconnect()
  }, [hasLoadingFinished])

  // Detecta scroll e controla visibilidade do logo
  useMotionValueEvent(scrollY, "change", (latest) => {
    if (hasLoadingFinished) {
      // Adiciona um pequeno threshold para evitar piscar
      if (latest > 60) {
        setIsVisible(false)
      } else if (latest < 40) {
        setIsVisible(true)
      }
    }
  })

  const containerVariants = {
    hidden: { y: -100 },
    visible: {
      y: 0,
      transition: {
        type: "spring",
        stiffness: 100,
        damping: 20,
        staggerChildren: 0.12,
        delayChildren: 0.1
      }
    },
    exit: {
      y: -100,
      transition: {
        duration: 0.3
      }
    }
  }

  const letterVariants = {
    hidden: { 
      opacity: 0,
      y: 15,
      scale: 0.9,
      rotate: -5,
      filter: "blur(4px)"
    },
    visible: {
      opacity: 1,
      y: 0,
      scale: 1,
      rotate: 0,
      filter: "blur(0px)",
      transition: {
        type: "spring",
        stiffness: 60,
        damping: 15,
        mass: 1.5,
        velocity: 2
      }
    }
  }

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          exit="exit"
          className="fixed top-4 left-6 z-50"
        >
          <Link href="/">
            <motion.svg 
              width="100" 
              height="32" 
              viewBox="0 0 1557 385" 
              fill="none" 
              xmlns="http://www.w3.org/2000/svg"
              className="h-8 w-auto opacity-80"
            >
              {/* A */}
              <motion.path 
                variants={letterVariants}
                d="M90.0563 2.04514C48.8174 9.50742 17.0046 41.2417 5.3792 86.408C1.53024 101.725 0.273438 112.33 0.273438 131.182C0.273438 150.034 1.53024 160.638 5.3792 175.798C13.5484 207.847 31.6149 233.375 56.751 248.457C65.4701 253.641 78.1166 258.354 89.3493 260.554C97.7542 262.203 118.727 262.439 127.053 260.868C145.905 257.49 160.908 249.792 173.712 236.989C181.881 228.819 182.667 228.741 184.081 236.596C185.887 246.1 190.915 252.856 199.241 256.783L203.64 258.826L238.437 259.061C272.45 259.297 273.157 259.297 273.157 257.726C273.157 253.955 242.444 47.8399 241.265 43.9909C237.102 29.6948 226.027 16.5769 212.673 9.97871C204.111 5.81555 197.199 3.93036 189.815 3.93036C185.73 3.93036 184.474 4.24454 184.081 5.18716C183.845 5.8941 183.609 10.6071 183.609 15.6343C183.609 23.6464 183.374 25.0603 182.196 26.16C179.525 28.5951 176.776 27.8096 171.591 23.0966C158.945 11.6283 144.57 4.71585 127.525 1.96658C118.57 0.474152 98.1469 0.552704 90.0563 2.04514ZM151.561 80.9095C165.307 85.1512 177.561 98.4262 181.646 113.508C183.452 120.185 184.081 135.188 182.824 142.728C180.703 156.161 174.026 167.707 164.129 175.091C156.745 180.668 149.833 183.103 140.014 183.575C125.875 184.281 115.978 180.59 106.159 170.849C100.032 164.88 96.1046 157.81 93.591 148.463C91.5487 141.236 91.5487 121.127 93.5125 113.901C98.5397 95.2056 111.815 82.5591 129.881 79.3385C135.38 78.3173 145.67 79.1028 151.561 80.9095Z" 
                fill="white"
              />
              {/* M */}
              <motion.path 
                variants={letterVariants}
                d="M424.366 2.43732C405.75 5.10803 387.212 14.534 373.937 28.0447C370.402 31.658 367.339 34.3287 367.182 34.0145C366.946 33.6217 366.553 31.3438 366.318 28.9087C365.139 19.4827 358.541 10.6851 349.508 6.44339L345.031 4.32253L303.713 4.08688C263.181 3.92978 262.396 3.92978 260.982 5.50078C259.647 6.99324 260.039 10.0567 275.435 113.664C284.154 172.341 291.617 222.064 292.088 224.263C293.502 230.626 298.608 240.366 302.928 244.922C308.112 250.263 315.26 254.898 321.78 257.018C326.336 258.511 329.164 258.746 345.188 259.061C362.783 259.375 363.411 259.296 364.982 257.725C366.632 256.076 366.632 256.076 366.632 185.93C366.632 127.411 366.868 115 367.81 110.444C372.052 90.4135 386.741 79.3379 409.049 79.3379C430.807 79.3379 445.968 91.2775 449.502 111.229C450.445 116.257 450.602 130.631 450.681 186.716C450.681 254.976 450.681 256.076 452.252 257.647C453.744 259.139 454.844 259.218 495.297 259.218C531.509 259.218 536.929 259.061 538.5 257.961L540.228 256.783V186.952C540.228 128.353 540.385 116.178 541.406 110.994C545.255 90.8062 560.179 79.3379 582.645 79.3379C602.675 79.3379 616.421 88.8425 622.391 106.83C623.727 110.758 623.884 115.785 624.276 167.314L624.669 223.477L626.476 228.583C631.974 243.822 644.307 254.819 659.467 258.04C663.394 258.904 671.014 259.218 689.316 259.218H713.824V178.782C713.824 91.5918 713.745 88.8425 709.503 73.1325C704.555 54.7517 696.543 40.7698 683.817 28.1232C666.693 11.2349 645.171 2.83008 616.421 1.80893C595.998 1.10196 583.43 3.53703 568.113 10.9993C555.388 17.2048 548.633 22.1534 537.321 33.5432C531.587 39.2773 526.246 43.9904 525.539 43.9904C523.575 43.9904 523.025 43.4405 519.019 38.0991C510.85 27.1021 499.067 17.6761 485.007 10.9993C470.947 4.24397 457.672 1.49472 440.076 1.65182C434.028 1.73038 426.958 2.04459 424.366 2.43732Z" 
                fill="white"
              />
              {/* A */}
              <motion.path 
                variants={letterVariants}
                d="M815.545 2.04492C788.131 6.99359 764.566 22.7036 748.385 46.8185C732.989 69.9123 725.605 97.1692 725.605 131.181C725.605 151.604 728.041 168.257 733.539 184.91C739.902 204.312 748.464 218.529 762.131 232.197C777.291 247.514 792.216 255.683 813.032 260.161C822.772 262.203 843.431 262.596 852.857 260.868C871.316 257.49 887.419 249.164 899.751 236.596C905.485 230.704 906.349 230.155 907.763 230.94C909.02 231.568 909.413 232.511 909.413 234.868C909.413 241.859 914.754 250.813 921.274 254.976C927.558 258.904 930.7 259.218 966.126 259.218H999.039L998.724 169.043C998.41 70.9334 998.724 76.9818 994.011 63.2355C991.733 56.5587 986.549 46.033 983.171 41.0844C968.797 20.2686 937.691 3.22318 915.697 4.08725L909.806 4.32288L909.413 14.7701C909.099 23.9604 908.863 25.3743 907.528 26.3955C904.464 28.5949 901.793 27.7308 896.609 22.9393C884.591 11.7066 870.452 4.87274 853.328 1.96637C844.53 0.473938 824.107 0.55249 815.545 2.04492ZM875.872 80.5165C889.383 84.6011 901.244 96.148 905.878 109.737C908.627 118.064 909.727 129.296 908.706 139.115C907.135 153.254 902.579 163.073 893.703 171.478C884.12 180.589 874.065 184.281 860.712 183.574C839.66 182.632 824.736 169.828 819.002 147.991C816.881 139.822 816.724 124.033 818.687 115.471C823.086 96.148 837.304 82.1661 855.527 79.2597C860.712 78.4742 871.159 79.1026 875.872 80.5165Z" 
                fill="white"
              />
              {/* G */}
              <motion.path 
                variants={letterVariants}
                d="M1105.79 1.7461C1106.89 1.589 1114.66 1.5099 1123.07 1.667C1135.48 1.8241 1139.64 2.21743 1144.98 3.55274C1159.28 7.16604 1171.93 13.7645 1181.67 22.6406C1188.03 28.453 1190.86 29.3174 1193.76 26.4111C1195.18 24.9972 1195.33 23.818 1195.33 16.1201C1195.33 11.3287 1195.73 6.77321 1196.12 5.90918C1196.83 4.65244 1197.85 4.417 1203.43 4.417C1211.36 4.417 1221.96 6.53781 1230.29 9.83692C1256.21 19.8913 1274.91 40.7851 1282.37 67.8848L1284.49 75.5049L1284.73 170.943C1284.88 234.438 1284.89 258.985 1284.03 272.576C1278.98 271.046 1273.62 270.224 1268.07 270.224C1237.7 270.224 1213.09 294.841 1213.09 325.208C1213.09 341.344 1220.04 355.857 1231.11 365.916C1217.32 374.445 1201.12 380.29 1182.77 383.186C1172.16 384.835 1135.17 384.6 1124.25 382.793C1091.88 377.452 1069.89 367.004 1051.12 348.152C1035.41 332.364 1029.36 320.738 1031.16 309.741C1033.13 297.723 1043.03 287.354 1056.69 283.034C1061.49 281.542 1064.39 280.042 1076.41 280.042C1093.77 280.042 1094.87 281.856 1113.01 293.952C1128.96 304.713 1132.49 306.049 1146.24 306.599C1158.57 307.148 1165.41 305.97 1173.34 302.043C1183.71 296.859 1189.52 289.082 1193.06 275.808C1194.31 270.938 1194.78 266.303 1195.1 255.228C1195.33 247.451 1195.33 240.145 1195.1 239.124C1194.55 237.16 1191.72 235.355 1189.13 235.354C1188.42 235.354 1186.77 236.454 1185.44 237.789C1181.35 242.109 1170.91 249.493 1163.99 252.949C1156.3 256.877 1147.34 259.862 1138.78 261.354C1130.3 262.926 1109.48 262.69 1100.92 261.04C1054.26 251.771 1021.97 214.381 1013.49 159.946C1011.76 148.399 1011.14 126.326 1012.23 114.387C1014.28 93.3355 1018.68 76.9969 1026.84 60.5801C1041.77 30.4955 1066.36 10.3868 1096.44 3.70997C1100.52 2.84592 1104.69 1.90321 1105.79 1.7461ZM1156.85 79.8252C1145.61 78.0971 1134.14 80.1386 1125.82 85.4014C1116.39 91.3712 1109.87 99.777 1106.1 110.853C1103.27 119.179 1102.57 135.674 1104.53 145.886C1109.09 168.979 1126.76 184.297 1148.99 184.297C1161.71 184.297 1171.3 180.212 1180.41 171.021C1187.17 164.266 1190.46 158.532 1193.14 149.342C1194.63 144.079 1194.86 141.251 1194.86 131.668C1194.79 113.287 1191.09 103.233 1180.72 92.6289C1174.2 85.9522 1165.25 81.1606 1156.85 79.8252Z" 
                fill="white"
              />
              {/* E */}
              <motion.path 
                variants={letterVariants}
                d="M1404.52 2.04465C1345.29 10.6852 1305.78 52.0025 1299.1 112.486C1297.29 128.51 1298.24 149.248 1301.46 164.879C1304.91 181.924 1313.16 200.619 1322.9 213.659C1329.5 222.535 1342.54 234.946 1351.18 240.68C1376.16 257.176 1409.86 264.873 1442.85 261.574C1491.39 256.626 1530.67 228.269 1546.77 186.559C1550.46 176.897 1550.93 173.912 1549.2 172.027C1547.87 170.535 1546.53 170.456 1513.07 170.456C1471.99 170.456 1475.29 169.906 1453.37 180.746C1437.66 188.523 1432.64 190.094 1423.92 190.094C1403.34 190.015 1390.61 177.604 1387.39 154.196L1386.84 150.033L1470.18 149.876C1548.89 149.64 1553.53 149.562 1554.86 148.226C1556.12 147.048 1556.27 144.927 1556.51 131.809C1556.9 110.601 1555.25 97.7973 1549.91 81.6945C1536.79 42.1838 1505.22 13.8272 1463.74 4.3226C1448.19 0.787842 1420.46 -0.311859 1404.52 2.04465ZM1437.9 72.6612C1443.87 74.0751 1448.11 76.1174 1453.45 80.202C1460.21 85.3864 1464.06 92.3773 1465.16 101.489L1465.71 106.045H1426.75C1395.01 106.045 1387.78 105.888 1387.78 105.024C1387.78 103.06 1390.3 95.4408 1392.1 91.906C1395.72 84.7579 1402.94 77.767 1409.7 74.9392C1417.48 71.5615 1429.34 70.6189 1437.9 72.6612Z" 
                fill="white"
              />
              {/* Ponto do G */}
              <motion.path 
                variants={letterVariants}
                fillRule="evenodd" 
                clipRule="evenodd" 
                d="M1257.37 285.237C1249.25 287.603 1242.03 292.363 1236.65 298.894C1231.27 305.426 1227.99 313.426 1227.23 321.852H1246.44C1247.56 309.03 1251.28 296.57 1257.36 285.231L1257.37 285.237ZM1246.44 329.357H1227.23C1227.99 337.783 1231.27 345.784 1236.65 352.317C1242.02 358.85 1249.24 363.61 1257.36 365.978C1251.28 354.638 1247.56 342.179 1246.44 329.357ZM1266.99 367.581C1259.71 356.037 1255.25 342.943 1253.97 329.357H1284.19C1282.91 342.943 1278.44 356.037 1271.17 367.581C1269.78 367.65 1268.38 367.65 1266.99 367.581ZM1280.8 365.972C1288.92 363.605 1296.14 358.845 1301.52 352.313C1306.89 345.782 1310.18 337.782 1310.94 329.357H1291.73C1290.61 342.179 1286.89 354.638 1280.8 365.978V365.972ZM1291.73 321.852H1310.94C1310.18 313.426 1306.9 305.425 1301.52 298.892C1296.14 292.359 1288.92 287.599 1280.8 285.231C1286.89 296.57 1290.61 309.03 1291.73 321.852ZM1266.99 283.628C1268.39 283.559 1269.78 283.559 1271.17 283.628C1278.45 295.173 1282.91 308.266 1284.19 321.852H1253.97C1255.27 308.182 1259.75 295.077 1266.99 283.628Z" 
                fill="white"
              />
            </motion.svg>
          </Link>
        </motion.div>
      )}
    </AnimatePresence>
  )
}